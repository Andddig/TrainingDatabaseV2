<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Training Database</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <%- include('./partials/header', { user }) %>
  
  <div class="container mt-4">
    <div class="row mb-4">
      <div class="col">
        <h1>Welcome, <%= user.firstName %>!</h1>
        <p>Manage your training and qualifications here.</p>
      </div>
    </div>
    
    <!-- What do you want to learn today? Card -->
    <div class="row mb-4">
      <div class="col">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-lightbulb mr-2"></i>What do you want to learn today?</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-3 mb-3">
                <a href="http://localhost:3000/mfri/find-class?courseType=Rescue&location=&title=&startDate=&endDate=" class="btn btn-outline-primary btn-block">
                  <i class="fas fa-life-ring mr-2"></i>Rescue
                </a>
              </div>
              <div class="col-md-3 mb-3">
                <a href="http://localhost:3000/mfri/find-class?courseType=Fire&location=&title=&startDate=&endDate=" class="btn btn-outline-danger btn-block">
                  <i class="fas fa-fire mr-2"></i>Fire
                </a>
              </div>
              <div class="col-md-3 mb-3">
                <a href="http://localhost:3000/mfri/find-class?courseType=EMS&location=&title=&startDate=&endDate=" class="btn btn-outline-success btn-block">
                  <i class="fas fa-ambulance mr-2"></i>EMS
                </a>
              </div>
              <div class="col-md-3 mb-3">
                <a href="http://localhost:3000/mfri/find-class?courseType=Management&location=&title=&startDate=&endDate=" class="btn btn-outline-info btn-block">
                  <i class="fas fa-users-cog mr-2"></i>Management
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Account Information</h5>
          </div>
          <div class="card-body">
            <p><strong>Name:</strong> <%= user.displayName %></p>
            <p><strong>Email:</strong> <%= user.email %></p>
            <p>
              <strong>Role<%= user.roles && user.roles.length > 1 ? 's' : '' %>:</strong> 
              <% if (user.isAdmin) { %>
                <span class="badge badge-success">Administrator</span>
                <% if (user.roles && user.roles.length > 0) { %> + <% } %>
              <% } %>
              <% if (user.roles && user.roles.length > 0) { %>
                <% user.roles.forEach(role => { %>
                  <span class="badge badge-info"><%= role %></span>
                <% }); %>
              <% } %>
            </p>
            <p><strong>Joined:</strong> <%= new Date(user.createdAt).toLocaleDateString() %></p>
          </div>
        </div>
      </div>
      
      <div class="col-md-8">
        <div class="card">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">Quick Access</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Training Section -->
              <div class="col-md-6 mb-4">
                <h5><i class="fas fa-graduation-cap"></i> Training</h5>
                <div class="list-group">
                  <a href="/training/find" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                      <h6 class="mb-1">Find a Class</h6>
                      <small><i class="fas fa-arrow-right"></i></small>
                    </div>
                    <small class="text-muted">Browse available training classes</small>
                  </a>
                  <a href="/training/submit" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                      <h6 class="mb-1">Submit Training</h6>
                      <small><i class="fas fa-arrow-right"></i></small>
                    </div>
                    <small class="text-muted">Upload new training certificates</small>
                  </a>
                  <a href="/training/my-submissions" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                      <h6 class="mb-1">My Submissions</h6>
                      <small><i class="fas fa-arrow-right"></i></small>
                    </div>
                    <small class="text-muted">View your training history</small>
                  </a>
                  <% if (user.roles.includes('Approver') || user.roles.includes('Training Officer') || user.isAdmin) { %>
                    <a href="/training/approver/dashboard" class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Approve Submissions</h6>
                        <small><i class="fas fa-arrow-right"></i></small>
                      </div>
                      <small class="text-muted">Review and approve training submissions</small>
                    </a>
                  <% } %>
                  <% if (user.isAdmin || user.roles.includes('Approver') || user.roles.includes('Training Officer') || user.roles.includes('Rescue Officer') || user.roles.includes('Evaluator') || user.roles.includes('Rescue Chief')) { %>
                    <a href="/demo/attendant-packet-queue" class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Attendant Packet Queue</h6>
                        <small><i class="fas fa-arrow-right"></i></small>
                      </div>
                      <small class="text-muted">Open role-based packet tasks</small>
                    </a>
                  <% } %>
                  <% if (user.roles.includes('Training Officer') || user.isAdmin) { %>
                    <a href="/training/manage-classes" class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Manage Classes</h6>
                        <small><i class="fas fa-arrow-right"></i></small>
                      </div>
                      <small class="text-muted">Create and edit training classes</small>
                    </a>
                  <% } %>
                </div>
              </div>
              
              <!-- Qualifications Section -->
              <div class="col-md-6 mb-4">
                <h5><i class="fas fa-certificate"></i> Qualifications</h5>
                <div class="list-group">
                  <a href="/qualifications/my" class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                      <h6 class="mb-1">My Qualifications</h6>
                      <small><i class="fas fa-arrow-right"></i></small>
                    </div>
                    <small class="text-muted">Track your qualification progress</small>
                  </a>
                  <% if (user.roles.includes('Training Officer') || user.isAdmin) { %>
                    <a href="/qualifications/dashboard" class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Qualification Dashboard</h6>
                        <small><i class="fas fa-arrow-right"></i></small>
                      </div>
                      <small class="text-muted">View all member qualifications</small>
                    </a>
                    <a href="/qualifications/manage" class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">Manage Qualifications</h6>
                        <small><i class="fas fa-arrow-right"></i></small>
                      </div>
                      <small class="text-muted">Define qualification requirements</small>
                    </a>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- In Progress Qualifications Card -->
    <div class="row mb-4">
      <div class="col">
        <div class="card">
          <div class="card-header bg-warning text-white">
            <h5 class="mb-0"><i class="fas fa-tasks mr-2"></i>In Progress Qualifications</h5>
          </div>
          <div class="card-body">
            <% if (inProgressQualifications && inProgressQualifications.length > 0) { %>
              <div class="row">
                <% inProgressQualifications.forEach(qual => { %>
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-body">
                        <h6 class="card-title"><%= qual.qualification.name %></h6>
                        <div class="progress mb-2">
                          <% 
                            const completedCount = qual.completedClasses.length;
                            const totalCount = completedCount + qual.missingClasses.length;
                            const percentage = totalCount > 0 ? Math.floor((completedCount / totalCount) * 100) : 0;
                          %>
                          <div class="progress-bar bg-warning" role="progressbar" style="width: <%= percentage %>%;" 
                               aria-valuenow="<%= percentage %>" aria-valuemin="0" aria-valuemax="100">
                            <%= percentage %>%
                          </div>
                        </div>
                        <p class="card-text">
                          <small class="text-muted">
                            <%= completedCount %> of <%= totalCount %> classes completed
                          </small>
                        </p>
                        <a href="/qualifications/my" class="btn btn-sm btn-outline-warning">View Details</a>
                      </div>
                    </div>
                  </div>
                <% }); %>
              </div>
            <% } else { %>
              <p class="text-muted mb-0">You don't have any qualifications in progress. <a href="/qualifications/my">Start a new qualification</a>.</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <%- include('./partials/footer') %>
  <%- include('./partials/scripts') %>
</body>
</html> 